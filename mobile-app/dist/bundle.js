/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t,n={220:(e,t,n)=>{var o,s,i;n.d(t,{Jb:()=>s,ru:()=>o}),function(e){e.Prompt="PROMPT",e.Camera="CAMERA",e.Photos="PHOTOS"}(o||(o={})),function(e){e.Rear="REAR",e.Front="FRONT"}(s||(s={})),function(e){e.Uri="uri",e.Base64="base64",e.DataUrl="dataUrl"}(i||(i={}))},546:(e,t,n)=>{n.d(t,{E_:()=>l,F3:()=>r,I9:()=>i,Ii:()=>a});const o=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return n.addPlatform=(e,t)=>{n.platforms.set(e,t)},n.setPlatform=e=>{n.platforms.has(e)&&(n.currentPlatform=n.platforms.get(e))},n})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{});var s;o.addPlatform,o.setPlatform,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(s||(s={}));class i extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const a=(e=>e.Capacitor=(e=>{var t,n,o,a,r;const l=e.CapacitorCustomPlatform||null,c=e.Capacitor||{},d=c.Plugins=c.Plugins||{},u=e.CapacitorPlatforms,h=(null===(t=null==u?void 0:u.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==l?l.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(e)),m=(null===(n=null==u?void 0:u.currentPlatform)||void 0===n?void 0:n.isNativePlatform)||(()=>"web"!==h()),p=(null===(o=null==u?void 0:u.currentPlatform)||void 0===o?void 0:o.isPluginAvailable)||(e=>{const t=y.get(e);return!!(null==t?void 0:t.platforms.has(h()))||!!g(e)}),g=(null===(a=null==u?void 0:u.currentPlatform)||void 0===a?void 0:a.getPluginHeader)||(e=>{var t;return null===(t=c.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)}),y=new Map,f=(null===(r=null==u?void 0:u.currentPlatform)||void 0===r?void 0:r.registerPlugin)||((e,t={})=>{const n=y.get(e);if(n)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),n.proxy;const o=h(),a=g(e);let r;const u=n=>{let d;const u=(...u)=>{const h=(async()=>(!r&&o in t?r=r="function"==typeof t[o]?await t[o]():t[o]:null!==l&&!r&&"web"in t&&(r=r="function"==typeof t.web?await t.web():t.web),r))().then(t=>{const r=((t,n)=>{var r,l;if(!a){if(t)return null===(l=t[n])||void 0===l?void 0:l.bind(t);throw new i(`"${e}" plugin is not implemented on ${o}`,s.Unimplemented)}{const o=null==a?void 0:a.methods.find(e=>n===e.name);if(o)return"promise"===o.rtype?t=>c.nativePromise(e,n.toString(),t):(t,o)=>c.nativeCallback(e,n.toString(),t,o);if(t)return null===(r=t[n])||void 0===r?void 0:r.bind(t)}})(t,n);if(r){const e=r(...u);return d=null==e?void 0:e.remove,e}throw new i(`"${e}.${n}()" is not implemented on ${o}`,s.Unimplemented)});return"addListener"===n&&(h.remove=async()=>d()),h};return u.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(u,"name",{value:n,writable:!1,configurable:!1}),u},m=u("addListener"),p=u("removeListener"),f=(e,t)=>{const n=m({eventName:e},t),o=async()=>{const o=await n;p({eventName:e,callbackId:o},t)},s=new Promise(e=>n.then(()=>e({remove:o})));return s.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await o()},s},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return a?f:m;case"removeListener":return p;default:return u(t)}}});return d[e]=v,y.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(t),...a?[o]:[]])}),v});return c.convertFileSrc||(c.convertFileSrc=e=>e),c.getPlatform=h,c.handleError=t=>e.console.error(t),c.isNativePlatform=m,c.isPluginAvailable=p,c.pluginMethodNoop=(e,t,n)=>Promise.reject(`${n} does not have an implementation of "${t}".`),c.registerPlugin=f,c.Exception=i,c.DEBUG=!!c.DEBUG,c.isLoggingEnabled=!!c.isLoggingEnabled,c.platform=c.getPlatform(),c.isNative=c.isNativePlatform(),c})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{}),r=a.registerPlugin;a.Plugins;class l{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n);const o=async()=>this.removeListener(e,t),s=Promise.resolve({remove:o});return Object.defineProperty(s,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await o()}}),s}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const n=this.listeners[e];n&&n.forEach(e=>e(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new a.Exception(e,s.Unimplemented)}unavailable(e="not available"){return new a.Exception(e,s.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const o=n.indexOf(t);this.listeners[e].splice(o,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const c=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),d=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class u extends l{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[n,o]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=d(n).trim(),o=d(o).trim(),t[n]=o}),t}async setCookie(e){try{const t=c(e.key),n=c(e.value),o=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),i=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${o}; path=${s}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}r("CapacitorCookies",{web:()=>new u});class h extends l{async request(e){const t=((e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((n,o,s)=>(n[o]=e[t[s]],n),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,o]of Object.entries(e.data||{}))t.set(n,o);n.body=t.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,n)=>{t.append(n,e)});else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const o=new Headers(n.headers);o.delete("content-type"),n.headers=o}else(o.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n})(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce((e,n)=>{const[o,s]=n;let i,a;return Array.isArray(s)?(a="",s.forEach(e=>{i=t?encodeURIComponent(e):e,a+=`${o}=${i}&`}),a.slice(0,-1)):(i=t?encodeURIComponent(s):s,a=`${o}=${i}`),`${e}&${a}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),o=n?`${e.url}?${n}`:e.url,s=await fetch(o,t),i=s.headers.get("content-type")||"";let a,r,{responseType:l="text"}=s.ok?e:{};switch(i.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":r=await s.blob(),a=await(async e=>new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{const e=o.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},o.onerror=e=>n(e),o.readAsDataURL(e)}))(r);break;case"json":a=await s.json();break;default:a=await s.text()}const c={};return s.headers.forEach((e,t)=>{c[t]=e}),{data:a,headers:c,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}r("CapacitorHttp",{web:()=>new h})}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var i=o[e]={exports:{}};return n[e](i,i.exports,s),i.exports}s.m=n,s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,n)=>(s.f[n](e,t),t),[])),s.u=e=>e+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="denonciation-rdc-mobile:",s.l=(n,o,i,a)=>{if(e[n])e[n].push(o);else{var r,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+i){r=u;break}}r||(l=!0,(r=document.createElement("script")).charset="utf-8",s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",t+i),r.src=n),e[n]=[o];var h=(t,o)=>{r.onerror=r.onload=null,clearTimeout(m);var s=e[n];if(delete e[n],r.parentNode&&r.parentNode.removeChild(r),s&&s.forEach(e=>e(o)),t)return t(o)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=h.bind(null,r.onerror),r.onload=h.bind(null,r.onload),l&&document.head.appendChild(r)}},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={792:0};s.f.j=(t,n)=>{var o=s.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var i=new Promise((n,s)=>o=e[t]=[n,s]);n.push(o[2]=i);var a=s.p+s.u(t),r=new Error;s.l(a,n=>{if(s.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",r.name="ChunkLoadError",r.type=i,r.request=a,o[1](r)}},"chunk-"+t,t)}};var t=(t,n)=>{var o,i,[a,r,l]=n,c=0;if(a.some(t=>0!==e[t])){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);l&&l(s)}for(t&&t(n);c<a.length;c++)i=a[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkdenonciation_rdc_mobile=self.webpackChunkdenonciation_rdc_mobile||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=s(546);s(220),(0,i.F3)("Camera",{web:()=>s.e(352).then(s.bind(s,352)).then(e=>new e.CameraWeb)});const a=(0,i.F3)("Geolocation",{web:()=>s.e(727).then(s.bind(s,727)).then(e=>new e.GeolocationWeb)}),r=(0,i.F3)("Preferences",{web:()=>s.e(619).then(s.bind(s,619)).then(e=>new e.PreferencesWeb)}),l=(0,i.F3)("Toast",{web:()=>s.e(268).then(s.bind(s,268)).then(e=>new e.ToastWeb)}),c=(0,i.F3)("App",{web:()=>s.e(168).then(s.bind(s,168)).then(e=>new e.AppWeb)}),d=(0,i.F3)("SplashScreen",{web:()=>s.e(411).then(s.bind(s,411)).then(e=>new e.SplashScreenWeb)}),u=new class{constructor(){this.API_BASE_URL="https://denonciation-app.onrender.com",this.currentUser=null,this.token=null,this.isNative=i.Ii.isNativePlatform(),this.currentCategory=null,this.currentCodeData=null,this.init()}async init(){await this.setupCapacitor(),this.setupEventListeners(),this.checkAuthentication(),this.loadInitialData()}async setupCapacitor(){try{await d.hide()}catch(e){console.log("Splash screen already hidden")}this.isNative&&c.addListener("backButton",e=>{e.canGoBack||c.exitApp()})}setupEventListeners(){document.querySelectorAll(".nav-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.page;this.showPage(n),document.querySelectorAll(".nav-item").forEach(e=>e.classList.remove("active")),e.classList.add("active")})}),document.getElementById("login-form").addEventListener("submit",e=>this.handleLogin(e)),document.getElementById("register-form").addEventListener("submit",e=>this.handleRegister(e)),document.getElementById("report-form").addEventListener("submit",e=>this.handleReport(e)),document.getElementById("request-reconnect").addEventListener("click",()=>this.handleReconnect()),document.getElementById("report-evidence").addEventListener("change",e=>{const t=e.target.files[0];t&&(document.getElementById("file-name").textContent=`Fichier: ${t.name}`,this.analyzeEvidence(t))});const e=document.getElementById("report-title"),t=document.getElementById("report-description");if(e&&t){let n;const o=()=>{clearTimeout(n),n=setTimeout(()=>{(e.value.length>10||t.value.length>50)&&this.performFakeNewsDetection(e.value,t.value)},1e3)};e.addEventListener("input",o),t.addEventListener("input",o)}}async checkAuthentication(){if(this.isNative){const{value:e}=await r.get({key:"auth_token"});this.token=e}else this.token=localStorage.getItem("token");this.token?await this.validateToken():this.showAuthModal()}async validateToken(){try{const e=await fetch(`${this.API_BASE_URL}/api/verify-token`,{headers:{Authorization:`Bearer ${this.token}`}});if(e.ok){const t=await e.json();this.currentUser=t.user,this.hideAuthModal(),this.updateProfile()}else this.showAuthModal()}catch(e){this.showAuthModal()}}showAuthModal(){document.getElementById("auth-modal").style.display="flex"}hideAuthModal(){document.getElementById("auth-modal").style.display="none",document.getElementById("register-modal").style.display="none",document.getElementById("code-modal").style.display="none"}showLogin(){document.getElementById("register-modal").style.display="none",document.getElementById("code-modal").style.display="none",document.getElementById("auth-modal").style.display="flex"}showRegister(){document.getElementById("auth-modal").style.display="none",document.getElementById("code-modal").style.display="none",document.getElementById("register-modal").style.display="flex"}async handleReconnect(){const e=document.getElementById("login-phone").value;if(e)try{const t=await fetch(`${this.API_BASE_URL}/api/request-reconnect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e})}),n=await t.json();n.success?this.showCodeModal(n.code,n.username,n.phoneNumber,"reconnect"):this.showToast(n.error)}catch(e){this.showToast("Erreur de connexion")}else this.showToast("Veuillez d'abord entrer votre numéro")}async handleLogin(e){e.preventDefault();const t=document.getElementById("login-phone").value,n=document.getElementById("login-code").value;try{const e=await fetch(`${this.API_BASE_URL}/api/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:t,code:n})}),o=await e.json();o.success?(this.token=o.token,this.currentUser={username:o.username,phoneNumber:t},this.isNative?await r.set({key:"auth_token",value:this.token}):localStorage.setItem("token",this.token),this.hideAuthModal(),this.updateProfile(),this.showToast("Connexion réussie!")):this.showToast(o.error)}catch(e){this.showToast("Erreur de connexion")}}async handleRegister(e){e.preventDefault();const t=document.getElementById("reg-phone").value,n=document.getElementById("reg-username").value;try{const e=await fetch(`${this.API_BASE_URL}/api/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:t,username:n})}),o=await e.json();o.success?this.showCodeModal(o.code,o.username,o.phoneNumber,"register"):this.showToast(o.error)}catch(e){this.showToast("Erreur d'inscription")}}showCodeModal(e,t,n,o="register"){this.currentCodeData={code:e,username:t,phoneNumber:n,type:o};const s="register"===o?"Inscription Réussie":"Nouveau Code",i="register"===o?"Utilisez ce code pour vous connecter":"Utilisez ce code pour vous reconnecter";document.getElementById("mobile-code-title").textContent=s,document.getElementById("mobile-code-message").textContent=i,document.getElementById("mobile-code-user").textContent=`Pour: ${t} (${n})`,document.getElementById("mobile-code-value").textContent=e,document.getElementById("code-modal").style.display="flex","reconnect"===o&&this.copyCode()}async copyCode(){this.currentCodeData&&(this.isNative?await l.show({text:"Code copié!",duration:"short"}):navigator.clipboard.writeText(this.currentCodeData.code).then(()=>{this.showToast("Code copié!")}))}returnToLogin(){this.currentCodeData&&(document.getElementById("code-modal").style.display="none",this.showLogin(),document.getElementById("login-phone").value=this.currentCodeData.phoneNumber,document.getElementById("login-code").value=this.currentCodeData.code,this.showToast("Code collé automatiquement!"))}async handleReport(e){if(e.preventDefault(),!this.token)return this.showToast("Veuillez vous connecter"),void this.showAuthModal();const t=new FormData;t.append("type",document.getElementById("report-type").value),t.append("title",document.getElementById("report-title").value),t.append("description",document.getElementById("report-description").value),t.append("locationName",document.getElementById("report-location").value);const n=document.getElementById("report-evidence").files[0];if(n){t.append("evidence",n);try{this.showToast("Publication en cours...");const e=await fetch(`${this.API_BASE_URL}/api/posts`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:t}),n=await e.json();n.success?(this.showToast("Signalement publié avec IA!"),document.getElementById("report-form").reset(),document.getElementById("file-name").textContent="",document.getElementById("ai-analysis-mobile").style.display="none",this.showPage("home"),this.loadPosts()):this.showToast(n.error)}catch(e){this.showToast("Erreur de publication")}}else this.showToast("Une preuve est obligatoire")}async getLocation(){try{this.showToast("Localisation en cours...");const e=await a.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}),t=e.coords.latitude,n=e.coords.longitude;document.getElementById("report-location").value=`Position: ${t.toFixed(4)}, ${n.toFixed(4)}`,this.showToast("Position obtenue")}catch(e){this.showToast("Impossible d'obtenir la position")}}async performFakeNewsDetection(e,t){try{const n=await fetch(`${this.API_BASE_URL}/api/ai/detect-fake`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json"},body:JSON.stringify({title:e,description:t,evidenceType:"text"})}),o=await n.json();this.displayMobileAnalysis(o.analysis,"fake")}catch(e){console.error("Erreur détection fake news:",e)}}async analyzeEvidence(e){try{const t=new FormData;t.append("evidence",e);const n=await fetch(`${this.API_BASE_URL}/api/ai/analyze-evidence`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:t}),o=await n.json();this.displayMobileAnalysis(o.analysis,"evidence")}catch(e){console.error("Erreur analyse preuve:",e)}}displayMobileAnalysis(e,t){const n=document.getElementById("mobile-analysis-result"),o=document.getElementById("ai-analysis-mobile");if(!e)return void(o.style.display="none");let s="";if("fake"===t)s=`\n                <div style="font-size: 0.9rem;">\n                    <div style="margin-bottom: 5px;">\n                        <strong>Risque fake:</strong> ${e.fake_probability||0}%\n                    </div>\n                    <div>\n                        <strong>Crédibilité:</strong> ${e.credibility_score}%\n                    </div>\n                </div>\n            `;else{const t=e.confidence||e.authenticity_score||0;s=`\n                <div style="font-size: 0.9rem;">\n                    <div style="margin-bottom: 5px;">\n                        <strong>Authenticité:</strong> ${Math.round(100*t)}%\n                    </div>\n                    ${e.detectedObjects&&e.detectedObjects.length>0?`\n                        <div>\n                            <strong>Détecté:</strong> ${e.detectedObjects.slice(0,2).join(", ")}\n                        </div>\n                    `:""}\n                </div>\n            `}n.innerHTML=s,o.style.display="block"}async loadCategories(){try{const e=await fetch(`${this.API_BASE_URL}/api/categories`),t=await e.json();this.renderMobileCategories(t,"mobile-categories"),this.renderMobileCategories(t,"all-categories")}catch(e){console.error("Erreur chargement catégories:",e)}}renderMobileCategories(e,t){const n=document.getElementById(t);if(!n)return;const o={corruption:"money-bill-wave",viol:"female",vole:"gem",arrestation_arbitraire:"handcuffs",agressions:"user-injured",enlevement:"exclamation-triangle",autres:"ellipsis-h"};n.innerHTML=e.map(e=>`\n            <div class="category-card" onclick="app.loadCategoryPosts('${e.name}')">\n                <i class="fas fa-${o[e.name]||"folder"}" style="font-size: 1.5rem; color: #e74c3c; margin-bottom: 8px;"></i>\n                <div style="font-weight: bold; font-size: 0.9rem;">${this.formatCategoryName(e.name)}</div>\n                <div style="color: #666; font-size: 0.8rem;">${e.post_count} signalements</div>\n            </div>\n        `).join("")}async loadCategoryPosts(e){this.currentCategory=e,this.showPage("categories");try{const t=await fetch(`${this.API_BASE_URL}/api/categories/${e}/posts`),n=await t.json(),o=document.getElementById("category-posts-mobile");if(o.innerHTML="",0===n.posts.length)return void(o.innerHTML='\n                    <div class="mobile-card" style="text-align: center; color: #666;">\n                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px;"></i>\n                        <p>Aucun signalement dans cette catégorie</p>\n                    </div>\n                ');n.posts.forEach(e=>{const t=this.createPostElement(e);o.appendChild(t)})}catch(e){this.showToast("Erreur chargement catégorie")}}createPostElement(e){const t=document.createElement("div");t.className="post-item";let n="";if(e.ai_analysis){const t=e.ai_analysis.confidence||0;n=`\n                <div class="ai-analysis-mobile">\n                    <div style="font-size: 0.8rem;">\n                        <i class="fas fa-robot"></i> IA: ${Math.round(100*t)}% de confiance\n                    </div>\n                </div>\n            `}return t.innerHTML=`\n            <div class="post-header">\n                <span class="post-type" style="background: ${e.color}">${this.formatCategoryName(e.type_name)}</span>\n                <span style="color: #666; font-size: 0.9rem;">${new Date(e.created_at).toLocaleDateString("fr-FR")}</span>\n            </div>\n            <div class="post-title">${e.title}</div>\n            <p style="margin-bottom: 10px; color: #666;">${e.description.substring(0,100)}...</p>\n            ${n}\n            <div class="post-meta">\n                <span>par ${e.username}</span>\n                <span><i class="fas fa-comments"></i> ${e.comment_count||0}</span>\n            </div>\n        `,t}async loadPosts(){try{const e=await fetch(`${this.API_BASE_URL}/api/posts`),t=await e.json(),n=document.getElementById("posts-container");if(n.innerHTML="",0===t.length)return void(n.innerHTML='\n                    <div class="mobile-card" style="text-align: center; color: #666;">\n                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px;"></i>\n                        <p>Aucun signalement pour le moment</p>\n                    </div>\n                ');t.forEach(e=>{const t=this.createPostElement(e);n.appendChild(t)})}catch(e){console.error("Erreur chargement posts:",e),this.showToast("Erreur chargement")}}showPage(e){switch(document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active")}),document.getElementById(`${e}-page`).classList.add("active"),e){case"home":this.loadPosts(),this.loadCategories();break;case"categories":this.currentCategory&&this.loadCategoryPosts(this.currentCategory);break;case"stats":this.loadIAStats()}}updateProfile(){this.currentUser&&(document.getElementById("profile-username").textContent=this.currentUser.username,document.getElementById("profile-phone").textContent=this.currentUser.phoneNumber||"+243 ...")}async loadIAStats(){document.getElementById("mobile-ai-analyzed").textContent="150+",document.getElementById("mobile-ai-confidence").textContent="85%"}async loadInitialData(){this.loadPosts(),this.loadCategories()}async logout(){this.token=null,this.currentUser=null,this.isNative?await r.remove({key:"auth_token"}):localStorage.removeItem("token"),this.showAuthModal(),this.showToast("Déconnexion réussie")}async showToast(e){this.isNative?await l.show({text:e,duration:"short"}):console.log("TOAST:",e)}formatCategoryName(e){return{corruption:"Corruption",viol:"Viol",vole:"Vol",arrestation_arbitraire:"Arrestation",agressions:"Agressions",enlevement:"Enlèvement",autres:"Autres"}[e]||e}};window.app=u})();