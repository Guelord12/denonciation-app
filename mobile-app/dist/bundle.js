/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t,n={220:(e,t,n)=>{var o,s,r;n.d(t,{Jb:()=>s,ru:()=>o}),function(e){e.Prompt="PROMPT",e.Camera="CAMERA",e.Photos="PHOTOS"}(o||(o={})),function(e){e.Rear="REAR",e.Front="FRONT"}(s||(s={})),function(e){e.Uri="uri",e.Base64="base64",e.DataUrl="dataUrl"}(r||(r={}))},546:(e,t,n)=>{n.d(t,{E_:()=>l,F3:()=>a,I9:()=>r,Ii:()=>i});const o=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return n.addPlatform=(e,t)=>{n.platforms.set(e,t)},n.setPlatform=e=>{n.platforms.has(e)&&(n.currentPlatform=n.platforms.get(e))},n})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{});var s;o.addPlatform,o.setPlatform,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(s||(s={}));class r extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const i=(e=>e.Capacitor=(e=>{var t,n,o,i,a;const l=e.CapacitorCustomPlatform||null,c=e.Capacitor||{},d=c.Plugins=c.Plugins||{},u=e.CapacitorPlatforms,m=(null===(t=null==u?void 0:u.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==l?l.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(e)),h=(null===(n=null==u?void 0:u.currentPlatform)||void 0===n?void 0:n.isNativePlatform)||(()=>"web"!==m()),p=(null===(o=null==u?void 0:u.currentPlatform)||void 0===o?void 0:o.isPluginAvailable)||(e=>{const t=f.get(e);return!!(null==t?void 0:t.platforms.has(m()))||!!g(e)}),g=(null===(i=null==u?void 0:u.currentPlatform)||void 0===i?void 0:i.getPluginHeader)||(e=>{var t;return null===(t=c.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)}),f=new Map,y=(null===(a=null==u?void 0:u.currentPlatform)||void 0===a?void 0:a.registerPlugin)||((e,t={})=>{const n=f.get(e);if(n)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),n.proxy;const o=m(),i=g(e);let a;const u=n=>{let d;const u=(...u)=>{const m=(async()=>(!a&&o in t?a=a="function"==typeof t[o]?await t[o]():t[o]:null!==l&&!a&&"web"in t&&(a=a="function"==typeof t.web?await t.web():t.web),a))().then(t=>{const a=((t,n)=>{var a,l;if(!i){if(t)return null===(l=t[n])||void 0===l?void 0:l.bind(t);throw new r(`"${e}" plugin is not implemented on ${o}`,s.Unimplemented)}{const o=null==i?void 0:i.methods.find(e=>n===e.name);if(o)return"promise"===o.rtype?t=>c.nativePromise(e,n.toString(),t):(t,o)=>c.nativeCallback(e,n.toString(),t,o);if(t)return null===(a=t[n])||void 0===a?void 0:a.bind(t)}})(t,n);if(a){const e=a(...u);return d=null==e?void 0:e.remove,e}throw new r(`"${e}.${n}()" is not implemented on ${o}`,s.Unimplemented)});return"addListener"===n&&(m.remove=async()=>d()),m};return u.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(u,"name",{value:n,writable:!1,configurable:!1}),u},h=u("addListener"),p=u("removeListener"),y=(e,t)=>{const n=h({eventName:e},t),o=async()=>{const o=await n;p({eventName:e,callbackId:o},t)},s=new Promise(e=>n.then(()=>e({remove:o})));return s.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await o()},s},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return i?y:h;case"removeListener":return p;default:return u(t)}}});return d[e]=v,f.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(t),...i?[o]:[]])}),v});return c.convertFileSrc||(c.convertFileSrc=e=>e),c.getPlatform=m,c.handleError=t=>e.console.error(t),c.isNativePlatform=h,c.isPluginAvailable=p,c.pluginMethodNoop=(e,t,n)=>Promise.reject(`${n} does not have an implementation of "${t}".`),c.registerPlugin=y,c.Exception=r,c.DEBUG=!!c.DEBUG,c.isLoggingEnabled=!!c.isLoggingEnabled,c.platform=c.getPlatform(),c.isNative=c.isNativePlatform(),c})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{}),a=i.registerPlugin;i.Plugins;class l{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n);const o=async()=>this.removeListener(e,t),s=Promise.resolve({remove:o});return Object.defineProperty(s,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await o()}}),s}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const n=this.listeners[e];n&&n.forEach(e=>e(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new i.Exception(e,s.Unimplemented)}unavailable(e="not available"){return new i.Exception(e,s.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const o=n.indexOf(t);this.listeners[e].splice(o,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const c=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),d=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class u extends l{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[n,o]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=d(n).trim(),o=d(o).trim(),t[n]=o}),t}async setCookie(e){try{const t=c(e.key),n=c(e.value),o=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),r=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${o}; path=${s}; ${r};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}a("CapacitorCookies",{web:()=>new u});class m extends l{async request(e){const t=((e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((n,o,s)=>(n[o]=e[t[s]],n),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,o]of Object.entries(e.data||{}))t.set(n,o);n.body=t.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,n)=>{t.append(n,e)});else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const o=new Headers(n.headers);o.delete("content-type"),n.headers=o}else(o.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n})(e,e.webFetchExtra),n=((e,t=!0)=>e?Object.entries(e).reduce((e,n)=>{const[o,s]=n;let r,i;return Array.isArray(s)?(i="",s.forEach(e=>{r=t?encodeURIComponent(e):e,i+=`${o}=${r}&`}),i.slice(0,-1)):(r=t?encodeURIComponent(s):s,i=`${o}=${r}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),o=n?`${e.url}?${n}`:e.url,s=await fetch(o,t),r=s.headers.get("content-type")||"";let i,a,{responseType:l="text"}=s.ok?e:{};switch(r.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":a=await s.blob(),i=await(async e=>new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{const e=o.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},o.onerror=e=>n(e),o.readAsDataURL(e)}))(a);break;case"json":i=await s.json();break;default:i=await s.text()}const c={};return s.headers.forEach((e,t)=>{c[t]=e}),{data:i,headers:c,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}a("CapacitorHttp",{web:()=>new m})}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e](r,r.exports,s),r.exports}s.m=n,s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce((t,n)=>(s.f[n](e,t),t),[])),s.u=e=>e+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="denonciation-rdc-mobile:",s.l=(n,o,r,i)=>{if(e[n])e[n].push(o);else{var a,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+r){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",t+r),a.src=n),e[n]=[o];var m=(t,o)=>{a.onerror=a.onload=null,clearTimeout(h);var s=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach(e=>e(o)),t)return t(o)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=m.bind(null,a.onerror),a.onload=m.bind(null,a.onload),l&&document.head.appendChild(a)}},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={792:0};s.f.j=(t,n)=>{var o=s.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise((n,s)=>o=e[t]=[n,s]);n.push(o[2]=r);var i=s.p+s.u(t),a=new Error;s.l(i,n=>{if(s.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",a.name="ChunkLoadError",a.type=r,a.request=i,o[1](a)}},"chunk-"+t,t)}};var t=(t,n)=>{var o,r,[i,a,l]=n,c=0;if(i.some(t=>0!==e[t])){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);l&&l(s)}for(t&&t(n);c<i.length;c++)r=i[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunkdenonciation_rdc_mobile=self.webpackChunkdenonciation_rdc_mobile||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=s(546);s(220);const i=(0,r.F3)("Camera",{web:()=>s.e(352).then(s.bind(s,352)).then(e=>new e.CameraWeb)}),a=(0,r.F3)("Geolocation",{web:()=>s.e(727).then(s.bind(s,727)).then(e=>new e.GeolocationWeb)}),l=(0,r.F3)("Preferences",{web:()=>s.e(619).then(s.bind(s,619)).then(e=>new e.PreferencesWeb)}),c=(0,r.F3)("Toast",{web:()=>s.e(268).then(s.bind(s,268)).then(e=>new e.ToastWeb)}),d=(0,r.F3)("App",{web:()=>s.e(168).then(s.bind(s,168)).then(e=>new e.AppWeb)}),u=(0,r.F3)("SplashScreen",{web:()=>s.e(411).then(s.bind(s,411)).then(e=>new e.SplashScreenWeb)}),m=new class{constructor(){this.API_BASE_URL="https://denonciation-app.onrender.com",this.currentUser=null,this.token=null,this.isNative=r.Ii.isNativePlatform(),this.init()}async init(){await this.setupCapacitor(),this.setupEventListeners(),this.checkAuthentication(),this.loadInitialData(),this.testConnection()}async setupCapacitor(){try{await u.hide()}catch(e){console.log("Splash screen already hidden")}this.isNative&&d.addListener("backButton",e=>{e.canGoBack||d.exitApp()})}async testConnection(){try{const e=await fetch(`${this.API_BASE_URL}/api/test-db`),t=await e.json();console.log("✅ Connexion serveur:",t.status),this.isNative&&await c.show({text:"Serveur connecté",duration:"short"})}catch(e){console.error("❌ Erreur connexion serveur:",e),this.isNative&&await c.show({text:"Erreur connexion serveur",duration:"long"})}}setupEventListeners(){document.querySelectorAll(".nav-item").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.page;this.showPage(n),document.querySelectorAll(".nav-item").forEach(e=>e.classList.remove("active")),e.classList.add("active")})}),document.getElementById("login-form").addEventListener("submit",e=>this.handleLogin(e)),document.getElementById("register-form").addEventListener("submit",e=>this.handleRegister(e)),document.getElementById("report-form").addEventListener("submit",e=>this.handleReport(e)),document.getElementById("request-reconnect")?.addEventListener("click",()=>this.handleReconnect()),document.getElementById("report-evidence").addEventListener("change",e=>{const t=e.target.files[0];t&&(document.getElementById("file-name").textContent=`Fichier: ${t.name}`)}),document.getElementById("camera-btn")?.addEventListener("click",()=>this.takePhoto())}async checkAuthentication(){if(this.isNative){const{value:e}=await l.get({key:"auth_token"});this.token=e}else this.token=localStorage.getItem("token");this.token?await this.validateToken():this.showAuthModal()}async validateToken(){try{const e=await fetch(`${this.API_BASE_URL}/api/verify-token`,{headers:{Authorization:`Bearer ${this.token}`}});if(e.ok){const t=await e.json();this.currentUser=t.user,this.hideAuthModal(),this.updateProfile()}else this.showAuthModal()}catch(e){this.showAuthModal()}}showAuthModal(){document.getElementById("auth-modal").style.display="flex"}hideAuthModal(){document.getElementById("auth-modal").style.display="none",document.getElementById("register-modal").style.display="none",document.getElementById("code-modal").style.display="none"}showLogin(){document.getElementById("register-modal").style.display="none",document.getElementById("code-modal").style.display="none",document.getElementById("auth-modal").style.display="flex"}showRegister(){document.getElementById("auth-modal").style.display="none",document.getElementById("code-modal").style.display="none",document.getElementById("register-modal").style.display="flex"}async handleReconnect(){const e=document.getElementById("login-phone").value;if(e)try{const t=await fetch(`${this.API_BASE_URL}/api/request-reconnect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e})}),n=await t.json();n.success?this.showCodeModal(n.code,n.username,n.phoneNumber,"reconnect"):this.showToast(n.error,"error")}catch(e){this.showToast("Erreur de connexion","error")}else this.showToast("Veuillez d'abord entrer votre numéro","error")}async handleLogin(e){e.preventDefault();const t=document.getElementById("login-phone").value,n=document.getElementById("login-code").value;try{const e=await fetch(`${this.API_BASE_URL}/api/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:t,code:n})}),o=await e.json();o.success?(this.token=o.token,this.currentUser={username:o.username,phoneNumber:t},this.isNative?await l.set({key:"auth_token",value:this.token}):localStorage.setItem("token",this.token),this.hideAuthModal(),this.updateProfile(),this.showToast("Connexion réussie!")):this.showToast(o.error,"error")}catch(e){this.showToast("Erreur de connexion","error")}}async handleRegister(e){e.preventDefault();const t=document.getElementById("reg-phone").value,n=document.getElementById("reg-username").value;try{const e=await fetch(`${this.API_BASE_URL}/api/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:t,username:n})}),o=await e.json();o.success?this.showCodeModal(o.code,o.username,o.phoneNumber,"register"):this.showToast(o.error,"error")}catch(e){this.showToast("Erreur d'inscription","error")}}showCodeModal(e,t,n,o="register"){const s="register"===o?"Inscription Réussie":"Nouveau Code de Reconnexion",r="register"===o?"Utilisez ce code pour vous connecter":"Utilisez ce nouveau code pour vous reconnecter",i=document.createElement("div");i.className="mobile-modal",i.id="code-modal",i.style.display="flex",i.innerHTML=`\n            <div class="modal-content">\n                <div style="text-align: center; margin-bottom: 20px;">\n                    <div style="width: 60px; height: 60px; background: #27ae60; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; color: white; font-size: 1.5rem;">\n                        <i class="fas fa-key"></i>\n                    </div>\n                    <h3>${s}</h3>\n                    <p style="color: #666;">${r}</p>\n                </div>\n                \n                <div style="text-align: center; padding: 1rem;">\n                    <div style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">\n                        Pour: <strong>${t}</strong> (${n})\n                    </div>\n                    \n                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; border: 2px dashed #3498db; margin: 1rem 0;">\n                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">Votre code de vérification:</div>\n                        <div style="font-size: 2rem; font-weight: bold; color: #e74c3c; letter-spacing: 3px; margin: 1rem 0; font-family: monospace;">\n                            ${e}\n                        </div>\n                        <div style="font-size: 0.8rem; color: #e67e22;">\n                            ⏰ Expire dans 10 minutes\n                        </div>\n                    </div>\n                    \n                    <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; margin: 1rem 0;">\n                        <button class="mobile-btn" onclick="app.copyCode('${e}')">\n                            <i class="fas fa-copy"></i> Copier\n                        </button>\n                        \n                        <button class="mobile-btn mobile-btn-outline" onclick="app.returnToLogin('${e}', '${n}')">\n                            <i class="fas fa-arrow-left"></i> Connexion\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(i),"reconnect"===o&&this.copyCode(e)}async copyCode(e){this.isNative?await c.show({text:"Code copié!",duration:"short"}):navigator.clipboard.writeText(e).then(()=>{this.showToast("Code copié!")})}returnToLogin(e,t){document.getElementById("code-modal").remove(),this.showLogin(),document.getElementById("login-phone").value=t,document.getElementById("login-code").value=e,this.showToast("Code collé automatiquement!")}async handleReport(e){if(e.preventDefault(),!this.token)return this.showToast("Veuillez vous connecter","error"),void this.showAuthModal();const t=new FormData;t.append("type",document.getElementById("report-type").value),t.append("title",document.getElementById("report-title").value),t.append("description",document.getElementById("report-description").value),t.append("locationName",document.getElementById("report-location").value);const n=document.getElementById("report-evidence").files[0];if(n){t.append("evidence",n);try{this.showToast("Publication en cours...");const e=await fetch(`${this.API_BASE_URL}/api/posts`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:t}),n=await e.json();n.success?(this.showToast("Signalement publié!"),document.getElementById("report-form").reset(),document.getElementById("file-name").textContent="",this.showPage("home"),this.loadPosts()):this.showToast(n.error,"error")}catch(e){this.showToast("Erreur de publication","error")}}else this.showToast("Une preuve est obligatoire","error")}async getLocation(){try{this.showToast("Localisation en cours...");const e=await a.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}),t=e.coords.latitude,n=e.coords.longitude;document.getElementById("report-location").value=`Position: ${t.toFixed(4)}, ${n.toFixed(4)}`,this.showToast("Position obtenue")}catch(e){this.showToast("Impossible d'obtenir la position","error"),console.error("Erreur géolocalisation:",e)}}async takePhoto(){try{const e=await i.getPhoto({quality:90,allowEditing:!1,resultType:"base64",source:"CAMERA",direction:"REAR"}),t=await fetch(`data:image/jpeg;base64,${e.base64String}`),n=await t.blob(),o=new File([n],`photo_${Date.now()}.jpg`,{type:"image/jpeg"}),s=new DataTransfer;s.items.add(o),document.getElementById("report-evidence").files=s.files,document.getElementById("file-name").textContent=`Fichier: ${o.name}`,this.showToast("Photo prise!")}catch(e){"User cancelled photos app"!==e.message&&this.showToast("Erreur appareil photo","error")}}showPage(e){switch(document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active")}),document.getElementById(`${e}-page`).classList.add("active"),e){case"home":this.loadPosts();break;case"map":this.loadMap();break;case"profile":this.updateProfile()}}async loadPosts(){try{const e=await fetch(`${this.API_BASE_URL}/api/posts`),t=await e.json(),n=document.getElementById("posts-container");if(n.innerHTML="",0===t.length)return void(n.innerHTML='\n                    <div class="mobile-card" style="text-align: center; color: #666;">\n                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px;"></i>\n                        <p>Aucun signalement pour le moment</p>\n                    </div>\n                ');t.forEach(e=>{const t=this.createPostElement(e);n.appendChild(t)}),document.getElementById("total-posts").textContent=t.length}catch(e){console.error("Erreur chargement posts:",e),this.showToast("Erreur chargement","error")}}createPostElement(e){const t=document.createElement("div");return t.className="post-item",t.innerHTML=`\n            <div class="post-header">\n                <span class="post-type" style="background: ${e.color}">${this.formatTypeName(e.type_name)}</span>\n                <span style="color: #666; font-size: 0.9rem;">${new Date(e.created_at).toLocaleDateString("fr-FR")}</span>\n            </div>\n            <div class="post-title">${e.title}</div>\n            <p style="margin-bottom: 10px; color: #666;">${e.description.substring(0,100)}...</p>\n            <div class="post-meta">\n                <span>par ${e.username}</span>\n                <span><i class="fas fa-comments"></i> ${e.comment_count||0}</span>\n            </div>\n        `,t.addEventListener("click",()=>{this.showPostDetail(e)}),t}showPostDetail(e){this.showToast(`Détails: ${e.title}`)}async loadMap(){document.getElementById("map-container").innerHTML=`\n            <div style="text-align: center; padding: 20px;">\n                <i class="fas fa-map-marked-alt" style="font-size: 3rem; color: #e74c3c; margin-bottom: 10px;"></i>\n                <h3>Carte Interactive</h3>\n                <p style="color: #666; margin-bottom: 15px;">Visualisation des signalements en temps réel</p>\n                <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">Serveur: ${this.API_BASE_URL}</p>\n                <button class="mobile-btn mobile-btn-outline" onclick="app.refreshMap()">\n                    <i class="fas fa-sync"></i> Actualiser\n                </button>\n            </div>\n        `}refreshMap(){this.showToast("Carte actualisée")}updateProfile(){this.currentUser&&(document.getElementById("profile-username").textContent=this.currentUser.username,document.getElementById("profile-phone").textContent=this.currentUser.phoneNumber||"+243 ...",this.loadUserStats())}async loadUserStats(){document.getElementById("user-posts").textContent="0",document.getElementById("user-comments").textContent="0"}async loadInitialData(){this.loadPosts(),document.getElementById("total-users").textContent="150+"}async logout(){this.token=null,this.currentUser=null,this.isNative?await l.remove({key:"auth_token"}):localStorage.removeItem("token"),this.showAuthModal(),this.showToast("Déconnexion réussie")}async showToast(e,t="success"){this.isNative?await c.show({text:e,duration:"error"===t?"long":"short"}):console.log(`${t.toUpperCase()}: ${e}`)}formatTypeName(e){return{corruption:"Corruption",viol:"Viol",vole:"Vol",arrestation_arbitraire:"Arrestation",agressions:"Agressions",enlevement:"Enlèvement",autres:"Autres"}[e]||e}};window.app=m})();